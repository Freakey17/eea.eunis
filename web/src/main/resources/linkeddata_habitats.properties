#
# The list of queries in this file. Separated by whitespace.
#
queries = deliveries

#
# .endpoint, .title and .query are mandatory for all queries
# .summary - use HTML format - i.e. escape & and <
#

#
# Deliveries query
#
deliveries.endpoint = http://cr.eionet.europa.eu/sparql
deliveries.title = Reportnet deliveries
deliveries.summary = Files delivered through Reportnet with relevance to this habitat type.

# Links are defined as {queryId}.link.{labelColumn}={linkColumn}
# If the label column in SPARQL query is bound to ?filetitle and link itself to ?file
# then the property should be defined as: {queryId}.link.filetitle = file
# This will produce <a href="file">filetitle</a> in result row
deliveries.link.filetitle = file
deliveries.link.envtitle = envelope
deliveries.column.envtitle = Envelope
deliveries.column.filetitle = File

# Query
# [IDENTIFIER] is replaced with actual habitat ID before query will be executed
deliveries.query = \
	PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> \
	PREFIX dc: <http://purl.org/dc/elements/1.1/> \
	PREFIX dct: <http://purl.org/dc/terms/> \
	PREFIX e: <http://eunis.eea.europa.eu/rdf/species-schema.rdf#> \
	PREFIX rod: <http://rod.eionet.europa.eu/schema.rdf#> \
	SELECT DISTINCT xsd:date(?released) AS ?released ?coverage ?envelope ?envtitle \
	IRI(bif:concat(?sourcefile,'/manage_document')) AS ?file ?filetitle \
	WHERE { \
		GRAPH ?sourcefile { \
			_:reference ?pred <http://eunis.eea.europa.eu/habitats/[IDENTIFIER]> . \
            OPTIONAL { \
            	_:reference rdfs:label ?label \
            } \
        } \
        ?envelope rod:hasFile ?sourcefile; \
        rod:released ?released; \
        rod:locality _:locurl; \
        dc:title ?envtitle . \
        _:locurl rdfs:label ?coverage . \
        ?sourcefile dc:title ?filetitle \
    } ORDER BY DESC(?released)
